<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory Filtering Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .directory-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .directory-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .directory-input-label {
            display: block;
            padding: 20px;
            background: white;
            border: 2px solid #4facfe;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            color: #4facfe;
        }
        .directory-input-label:hover {
            background: #4facfe;
            color: white;
        }
        .selected-directory {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .selected-directory h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .directory-path {
            background: white;
            border: 1px solid #4caf50;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.9em;
            color: #333;
            word-break: break-all;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .file-count {
            color: #2e7d32;
            font-size: 0.9em;
            font-weight: 500;
        }
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 8px;
            margin: 10px 0;
            font-size: 0.8em;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Directory Filtering Test</h1>
        <p>This test demonstrates the improved directory filtering logic that correctly counts only actual files.</p>
        
        <div class="directory-input-wrapper">
            <input type="file" id="directoryInput" class="directory-input" webkitdirectory directory multiple>
            <label for="directoryInput" class="directory-input-label">
                üìÅ Choose a directory to test filtering<br>
                <small>Select a folder with 3 PDF files to test the count</small>
            </label>
        </div>
        
        <div class="selected-directory" id="selectedDirectory" style="display: none;">
            <h4>Selected Directory:</h4>
            <div class="directory-path" id="directoryPath">
                <!-- Directory path will be displayed here -->
            </div>
            <div class="file-count" id="fileCount">
                <!-- File count will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Directory input change handler
        document.getElementById('directoryInput').addEventListener('change', function(e) {
            const files = e.target.files;
            const selectedDirDiv = document.getElementById('selectedDirectory');
            const directoryPathDiv = document.getElementById('directoryPath');
            const fileCountDiv = document.getElementById('fileCount');
            
            if (files.length > 0) {
                // Get the directory path from the first file
                const firstFile = files[0];
                const fullPath = firstFile.webkitRelativePath || firstFile.name;
                const directoryPath = fullPath.substring(0, fullPath.lastIndexOf('/'));
                
                // Filter out directories and get only actual files
                const actualFiles = Array.from(files).filter(file => {
                    // More robust filtering:
                    // 1. Must have a file extension (contains a dot)
                    // 2. Must not end with '/' (directory indicator)
                    // 3. Must not be a hidden file starting with '.'
                    // 4. Must have a reasonable file size (not 0 for directories)
                    const hasExtension = file.name.includes('.') && !file.name.endsWith('/');
                    const notHidden = !file.name.startsWith('.');
                    const hasSize = file.size > 0;
                    
                    return hasExtension && notHidden && hasSize;
                });
                
                // Filter supported files from actual files
                const supportedFiles = actualFiles.filter(file => {
                    const extension = file.name.toLowerCase().split('.').pop();
                    return ['pdf', 'docx', 'txt', 'html'].includes(extension);
                });
                
                // Get file types breakdown
                const fileTypes = {};
                supportedFiles.forEach(file => {
                    const ext = file.name.toLowerCase().split('.').pop();
                    fileTypes[ext] = (fileTypes[ext] || 0) + 1;
                });
                
                // Create detailed path information
                let pathInfo = '';
                if (directoryPath) {
                    pathInfo = `üìÅ Selected Directory: ${directoryPath}`;
                } else {
                    pathInfo = 'üìÅ Selected Directory: Root Directory';
                }
                
                // Add file type breakdown
                const typeBreakdown = Object.entries(fileTypes)
                    .map(([ext, count]) => `${ext.toUpperCase()}: ${count}`)
                    .join(', ');
                
                // Create file list preview (show first 5 files)
                const fileList = supportedFiles.slice(0, 5).map(file => file.name).join(', ');
                const moreFiles = supportedFiles.length > 5 ? ` and ${supportedFiles.length - 5} more files` : '';
                
                // Debug information
                const rawFileNames = Array.from(files).map(f => f.name).join(', ');
                const actualFileNames = actualFiles.map(f => f.name).join(', ');
                const debugInfo = `Raw files (${files.length}): ${rawFileNames} | Actual files (${actualFiles.length}): ${actualFileNames}`;
                
                // Display directory information with enhanced details
                directoryPathDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">${pathInfo}</div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">
                        üìä File Types: ${typeBreakdown || 'None'}
                    </div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">
                        üìÇ Total Files: ${actualFiles.length} | ‚úÖ Supported: ${supportedFiles.length} | ‚ùå Unsupported: ${actualFiles.length - supportedFiles.length}
                    </div>
                    <div class="debug-info">
                        üîç ${debugInfo}
                    </div>
                    <div style="font-size: 0.85em; color: #555; background: #f8f9fa; padding: 6px; border-radius: 3px; margin-top: 6px;">
                        üìÑ Files: ${fileList}${moreFiles}
                    </div>
                `;
                
                fileCountDiv.textContent = `Ready to process ${supportedFiles.length} supported documents`;
                selectedDirDiv.style.display = 'block';
            } else {
                selectedDirDiv.style.display = 'none';
            }
        });
    </script>
</body>
</html>
